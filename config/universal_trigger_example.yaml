# 通用触发器配置示例
# 展示如何使用一个通用触发器类替代上百个具体的触发器实现

configId: "universal_trigger_example"
strategyId: 2001

strategies:
  # 替代紧急制动触发器 (EmergencyBrakingTrigger)
  - businessType: "ActiveSafetyTrigger"
    trigger:
      triggerName: "UniversalTrigger"
      triggerId: "emergency_braking_universal"
      priority: 1
      enabled: true
      # 表达式: 速度大于60km/h 且 距离前车小于20米 且 不在弯道上
      triggerCondition: "speed > 60.0 and distance_to_lead < 20.0 and not on_curve"
      # 可以添加额外的配置信息，如变量源等
      variables:
        - name: "speed"
          source: "/vehicle/status"
          field: "velocity"
        - name: "distance_to_lead"
          source: "/perception/objects"
          field: "closest_object.distance"
        - name: "on_curve"
          source: "/navigation/road"
          field: "curvature > 0.01"
    mode:
      triggerMode: 1
      cacheMode:
        forwardCaptureDurationSec: 10
        backwardCaptureDurationSec: 5
        cooldownDurationSec: 30
    enableMasking: false
    dds:
      channels:
        - topic: "/vehicle/status"
          type: "VehicleStatus"
          originalFrameRate: 100
          capturedFrameRate: 100
        - topic: "/perception/objects"
          type: "PerceptionObjects"
          originalFrameRate: 20
          capturedFrameRate: 20
    cyber:
      channels: []
    upload:
      destination: "cloud"
      priority: "high"

  # 替代FCW激活触发器 (FCWActiveTrigger)
  - businessType: "ActiveSafetyTrigger"
    trigger:
      triggerName: "UniversalTrigger"
      triggerId: "fcw_active_universal"
      priority: 2
      enabled: true
      # 表达式: 系统处于自动驾驶模式 且 存在碰撞风险 且 驾驶员未接管
      triggerCondition: "is_auto_mode and collision_risk and not driver_override"
      variables:
        - name: "is_auto_mode"
          source: "/autopilot/state"
          field: "mode"
        - name: "collision_risk"
          source: "/perception/objects"
          field: "collision_probability > 0.8"
        - name: "driver_override"
          source: "/vehicle/status"
          field: "driver_controlling"
    mode:
      triggerMode: 1
      cacheMode:
        forwardCaptureDurationSec: 5
        backwardCaptureDurationSec: 3
        cooldownDurationSec: 20
    enableMasking: false
    dds:
      channels:
        - topic: "/autopilot/state"
          type: "AutopilotState"
          originalFrameRate: 10
          capturedFrameRate: 10
        - topic: "/perception/objects"
          type: "PerceptionObjects"
          originalFrameRate: 20
          capturedFrameRate: 20
    cyber:
      channels: []
    upload:
      destination: "cloud"
      priority: "high"

  # 替代接管触发器 (TakeoverTrigger)
  - businessType: "DriverTakeover"
    trigger:
      triggerName: "UniversalTrigger"
      triggerId: "takeover_universal"
      priority: 3
      enabled: true
      # 表达式: 在匝道上 且 速度大于40km/h 且 雨天 且 系统请求接管
      triggerCondition: "on_ramp and speed > 40.0 and rainy_weather and takeover_requested"
      variables:
        - name: "on_ramp"
          source: "/navigation/route"
          field: "is_ramp"
        - name: "speed"
          source: "/vehicle/status"
          field: "velocity"
        - name: "rainy_weather"
          source: "/weather/status"
          field: "rain_intensity > 0.5"
        - name: "takeover_requested"
          source: "/autopilot/state"
          field: "takeover_requested"
    mode:
      triggerMode: 1
      cacheMode:
        forwardCaptureDurationSec: 15
        backwardCaptureDurationSec: 10
        cooldownDurationSec: 60
    enableMasking: false
    dds:
      channels:
        - topic: "/vehicle/status"
          type: "VehicleStatus"
          originalFrameRate: 100
          capturedFrameRate: 100
        - topic: "/weather/status"
          type: "WeatherStatus"
          originalFrameRate: 1
          capturedFrameRate: 1
        - topic: "/autopilot/state"
          type: "AutopilotState"
          originalFrameRate: 10
          capturedFrameRate: 10
    cyber:
      channels: []
    upload:
      destination: "cloud"
      priority: "medium"

  # 替代ACC退出触发器 (ACCQuitTrigger)
  - businessType: "FunctionActivationLimitation"
    trigger:
      triggerName: "UniversalTrigger"
      triggerId: "acc_quit_universal"
      priority: 4
      enabled: true
      # 表达式: ACC功能激活 且 车辆速度低于设定速度10km/h以上 且 持续时间超过5秒
      triggerCondition: "acc_active and (set_speed - speed) > 10.0 and duration > 5.0"
      variables:
        - name: "acc_active"
          source: "/vehicle/acc"
          field: "active"
        - name: "set_speed"
          source: "/vehicle/acc"
          field: "set_speed"
        - name: "speed"
          source: "/vehicle/status"
          field: "velocity"
        - name: "duration"
          source: "internal_timer"
          field: "elapsed_time"
    mode:
      triggerMode: 1
      cacheMode:
        forwardCaptureDurationSec: 8
        backwardCaptureDurationSec: 5
        cooldownDurationSec: 45
    enableMasking: false
    dds:
      channels:
        - topic: "/vehicle/acc"
          type: "ACCStatus"
          originalFrameRate: 10
          capturedFrameRate: 10
        - topic: "/vehicle/status"
          type: "VehicleStatus"
          originalFrameRate: 100
          capturedFrameRate: 100
    cyber:
      channels: []
    upload:
      destination: "cloud"
      priority: "medium"